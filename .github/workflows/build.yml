name: Build AutoTask APK

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Download code
      uses: actions/checkout@v4
      
    - name: ğŸ¤– Setup Android
      uses: android-actions/setup-android@v3
      
    - name: ğŸ”§ Create fixed build.gradle
      run: |
        # Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ build.gradle Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ø§Ù…Ù„
        cat > app/build.gradle << 'EOF'
        plugins {
            id 'com.android.application'
        }

        android {
            compileSdkVersion 33
            buildToolsVersion "33.0.0"

            defaultConfig {
                minSdkVersion 21
                targetSdkVersion 33
                versionCode 1
                versionName "1.0"
            }

            buildTypes {
                debug {
                    debuggable true
                }
                release {
                    minifyEnabled false
                    proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
                }
            }
        }

        dependencies {
            implementation fileTree(dir: 'libs', include: ['*.jar'])
        }
        EOF
        
        echo "sdk.dir=$ANDROID_HOME" > local.properties
        
    - name: ğŸ—ï¸ Build APK
      run: |
        chmod +x ./gradlew
        ./gradlew assembleDebug
        
    - name: ğŸ“¤ Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: AutoTask-APK
        path: app/build/outputs/apk/
