name: Build and Release AutoTask

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:  # Ø§Ù…Ú©Ø§Ù† Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ Ù‡Ù… Ø¯Ø§Ø±Ù‡

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ”§ Fix Android Configuration
      run: |
        # Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ local.properties
        echo "sdk.dir=$ANDROID_HOME" > local.properties
        
        # Ø¨Ø±Ø±Ø³ÛŒ Ùˆ ØªØ¹Ù…ÛŒØ± ÙØ§ÛŒÙ„ build.gradle
        if [ -f "app/build.gradle" ]; then
          # Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† compileSdkVersion Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ù‡
          if ! grep -q "compileSdkVersion" app/build.gradle; then
            sed -i '/android {/a\    compileSdkVersion 33' app/build.gradle
          fi
          if ! grep -q "minSdkVersion" app/build.gradle; then
            sed -i '/compileSdkVersion/a\    minSdkVersion 21' app/build.gradle
          fi
          if ! grep -q "targetSdkVersion" app/build.gradle; then
            sed -i '/minSdkVersion/a\    targetSdkVersion 33' app/build.gradle
          fi
        fi
        
    - name: ğŸ—ï¸ Build Release APK
      uses: alsrb968/action-release-apk@v0.1
      with:
        build_type: debug  # Ø§ÙˆÙ„ Ø¨Ø§ debug Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†
        # app_directory: ./  # Ø§Ú¯Ø± Ù¾Ø±ÙˆÚ˜Ù‡ Ø¯Ø± Ø±ÛŒØ´Ù‡ Ù†ÛŒØ³Øª
